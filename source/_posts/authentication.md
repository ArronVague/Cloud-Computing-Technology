---
title: 鉴权
toc: true
date: 2024-03-23 13:46:17
categories:
  - work
tags:
  - authentication
---

鉴权（Authentication）是确定一个用户或系统的身份的过程。在计算机安全领域，有多种常见的鉴权方法，以下是一些主要的类型：

<!--more-->

## **基于密码的鉴权**

这是最常见的鉴权方法，用户通过提供用户名和密码来证明其身份。系统会将输入的密码与存储（通常是散列）的密码进行比较，如果匹配，则鉴权成功。

## **多因素鉴权**

这种方法需要用户提供两个或更多的鉴权因素，通常包括“知道的东西”（如密码）、“拥有的东西”（如手机或安全令牌）和“是的人”（如指纹或面部识别）。

## **基于证书的鉴权**

在这种方法中，用户或统会提供一个由可信任的证书颁发机构（CA）签发的数字证书来证明其身份。数字证书包含了证书所有者的公钥和一些身份信息，以及 CA 的数字签名

## **基于令牌的鉴权**

这种方法中，用户首先通过用户名和密码（或其他方法）进行鉴权，然后系统会返回一个令牌（通常是 JWT，JSON Web Token）。用户可以使用这个令牌来进行后续的请求，而无需再次进行鉴权。

### JWT

JSON Web Token（JWT）是一种开放标准（RFC 7519），它定义了一种紧凑且自包含的方式，用于在各方之间安全地传输信息作为 JSON 对象。这种信息可以被验证和信任，因为它是数字签名的。JWT 可以使用秘密（使用 HMAC 算法）或使用 RSA 或 ECDSA 的公钥/私钥对进行签名。

无状态，服务端无需存储。

#### 基本工作流程

1. **用户登录**：用户通过提供用户名和密码（或其他鉴权信息）进行登录。
2. **生成 JWT**：如果用户的登录信息正确（此过程还需要访问数据库验证用户信息），服务器会生成一个包含用户信息（如用户 ID）的 JWT。JWT 由三部分组成：头部（Header）、载荷（Payload）和签名（Signature）。头部通常包含了令牌的类型和所使用的加密算法；载荷包含了一些声明（Claims），这些声明是关于实体（通常是用户）和其他数据的一些信息；签名是用来验证消息没有被改变（也就是为了保证数据的完整性）。
3. **发送 JWT**：服务器将生成的 JWT 发送给用户。用户将此 JWT 存储在本地，例如在 cookie 或 localStorage 中。
4. **使用 JWT**：当用户需要访问受保护的路由或资源时，用户将 JWT 附加到请求的 Authorization 头部，然后发送给服务器。
5. **验证 JWT**：服务器接收到请求后，它会做以下几件事来验证 JWT 的有效性：
   1. 验证签名：服务端会使用在头部指定的算法和它自己的密钥（这个密钥只有服务端知道）来重新计算签名，然后和 JWT 中的签名进行比较。如果两个签名不一致，那么这个 JWT 就是无效的，因为它可能被篡改过。
   2. 验证声明：服务端会检查 JWT 中的声明。例如，它可能会检查 "exp"（过期时间）声明来确保 JWT 还没有过期，检查 "nbf"（不早于）声明来确保 JWT 已经可以被使用，或者检查 "aud"（接收者）声明来确保自己是这个 JWT 的接收者。
   3. 验证权限：一旦 JWT 被验证为有效，服务端还需要检查 JWT 中的用户信息，以确定用户是否具有执行请求操作的权限。


#### 用户修改密码，如何使token失效？

JWT 本身是无状态的，并且服务端不存储 JWT，所以你不能直接从服务端使一个 JWT 失效。

但是，你可以采用以下一些策略来间接达到这个目标：

1. **短期过期时间**：你可以给 JWT 设置一个短的过期时间，例如 15 分钟。这样，即使 JWT 落入了错误的手中，它也很快就会失效。当然，这也意味着用户需要频繁地重新认证。
2. **刷新令牌**：为了解决短期过期时间带来的问题，你可以使用刷新令牌（Refresh Token）。当 JWT 过期后，用户可以使用刷新令牌来获取一个新的 JWT。刷新令牌通常有一个长的过期时间，例如 24 小时，或者 7 天。当用户修改密码后，你可以使该用户的所有刷新令牌失效。
3. **黑名单**：你可以在服务端维护一个 JWT 黑名单。当用户修改密码后，你可以把该用户的所有 JWT 加入黑名单。然后，在验证 JWT 时，你需要检查 JWT 是否在黑名单中。这种方法需要服务端存储 JWT，所以它违反了 JWT 是无状态的原则，但在一些情况下，这可能是一个可接受的妥协。
4. **版本控制**：你可以在 JWT 的有效载荷中包含一个版本号（例如，密码的哈希值或者密码最后修改时间）。当用户修改密码后，版本号会改变，所以旧的 JWT 就会失效。这种方法的优点是它不需要服务端存储 JWT，缺点是它需要你在用户修改密码后，通知所有使用 JWT 的服务更新版本号。

## **基于生物特征的鉴权**

这种方法使用用户的生物特征，如指纹、面部识别、虹膜扫描等来进行鉴权。

## **基于行为的鉴权**

这是一种更复杂的鉴权方法，它使用机器学习或其他统计方法来分析用户的行为模式（如键盘输入模式、鼠标移动模式等），然后根据这些模式来进行鉴权。

以上各种鉴权方法各有优点和缺点，需要根据具体的应用需求和安全需求来选择合适的方法。在实践中，通常会使用多种鉴权方法的组合，以提高安全性。
